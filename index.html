<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Luffy's Jumping Game</title>
    <link rel="stylesheet" href="style.css" />
  </head>
        <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
  <script src="back.js"></script>

    <div class="container">
      <div class="game-container">
        <div id="game-insights">
          <!-- <p>Username: <span id="name"></span></p> -->
          <p><span id="score">Score: 0</span></p>
          <span class="lives">
            <img id = "L1" src="heart.png" alt="heart" width="40" height="40" hidden>
            <img id = "L2" src="heart.png" alt="heart" width="40" height="40" hidden>
            <img id = "L3" src="heart.png" alt="heart" width="40" height="40" hidden>
          </span>
<!--p style="font-size: 45px; color: red;">&#10084;&#10084;&#10084;</p-->
<!-- implementare funzione che li printa e fa il get con async con diminuzione ed incremento in caso di pagamento -->
        </div>
        <div class="background" id="background"></div>
        <img id="luffy" src="luffy_run_render.gif" alt="Luffy" />
      </div>

      <div class="start-game">
        <form action="" id="game-form">
          <div class="flex">
            <label for="username">Username:</label>
            <input
              type="text"
              id="username"
              maxlength="10"
              placeholder="Enter your username"
              required
            />
          </div>
          <div class="btns">
            <button id="start" type="button" onclick="startBtnEvent()" cursor>Start Game</button>
            <button id="mint" type="button" onclick="mintBtnEvent()" disabled cursor>Mint your score!</button>
            <button id="restart" type="button" disabled cursor>Restart Game</button>
            <script>
              var score;
/*
              async function ottieniDati() {
                const response = await fetch('http://localhost:3000/api/dati');
                const dati = await response.json();
                const table = document.getElementById('rankTable');
                dati.forEach((dato) => {
                const listItem = document.createElement('ol');
                listItem.textContent = num +`. ${dato.username} - ${dato.score}`;
                elencoDati.appendChild(listItem);
                num++
              });


              }
              console.log(dati);*/

              function startBtnEvent(){
                makePayment()
                .then(x => startGame());
              }

              function mintBtnEvent(){
                keygen()
                .then(chiave => {
                  alert(chiave);
                  var username = document.getElementById('username').value;

                  data={
                  "username": username,
                  "score": score,
                  "chiave": 'fgctrdfch'//chiave
                  }
                  console.log(data);
                   fetch("http://127.0.0.1:3000/api/dati", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        // Handle the response from the server here if needed
        console.log('Server response:', data);
    })
    .catch(error => {
        console.error('Error:', error);
    });
                  //INSERIRE QUA DENTRO LA CALL PER MINTARE NEL DB LA CHIAVE
                });
              }
//               const startBtn = document.getElementById('start');
//               const mintBtn = document.getElementById('mint');
//
//               async function payment(){
//                 try{
//                   const payment = await makePayment();
//                   if(!payment){
//                     startGame();
//                   }else{
//                     alert('You have to pay before play!')
//                   }
//                 } catch (error) {
//                   console.error("Error:", error);
//                 }
//               }
//               /*onclick="makePayment()" onclick="keygen()"*/
//               startBtn.addEventListener('click',payment);
//               function key(){
//                 try{
//                   keygen()
//                   .then( chiave => {
//                       console.log("catch promise", chiave);
//                       alert(chiave);
//                       mintBtn.disabled=true;
//                   });
//
//                 }catch (error) {
//                   console.error("Error:", error);
//                 }
//               }
//
//               mintBtn.addEventListener('click', key);


            </script>
          </div>
          <!-- da sismtemare tabella con css corretti-->
          <div>
          <p></p>
          <table class="mainTable">
          <tr>
          <th>
<table id="rankTable" class="rankTable">
  <thead>
    <tr>
      <th>Highest</th>
      <th>Score!</th>
      <script>
        /*
        // Dimensioni della matrice
        var n=0; // Numero di righe
        var cols = 2; // Numero di colonne
      
        // Funzione per generare la matrice numerata
        function generateNumberedMatrix(rows, cols) {
          var table = document.getElementById('rankTable');
          //table += '<tr><th></th>'; // Cella vuota per l'angolo in alto a sinistra
      
          // Intestazione delle colonne numerate
          //for (var j = 1; j <= cols; j++) {
          //  table += '<th>' + j + '</th>';
          //}
      
          //table += '</tr>';
      
          // Contenuto della matrice con numeri di riga e colonne
          dati.forEach((dato) =>{
            table += '<tr>';
            table += '<th>'+n+' '+ dato.nikname - ${dato.score}
          }
          for (var i = 1; i <= rows; i++) {
            table += '<tr>';
            table += '<th>' + i + dati[1]+' - '+ dati[0]+'</th>'; // Numero di riga
      
            for (var j = 1; j <= cols; j++) {
              table += '<td>' + (i * cols + j) + '</td>'; // Calcolo del numero nella cella
            }
      
            table += '</tr>';
          }
      
          table += '</table>';
      
          return table;
        }
      
        // Inserisci la matrice numerata nella pagina HTML
        document.body.innerHTML += generateNumberedMatrix(rows, cols);*/
      </script>
      
    </tr>
  </thead>
  <tbody id="tableBody">
  </tbody>
</table>
</th>

<th>

<h1>How to play?
</h1>
<p>
Playing this game is simple, just use the space bar!
By clicking on Start game a payment will be made using metamask <br> which will allow you to receive 3 lives which you can use to get the highest score! <br>If you get tired you can also pause and resume whenever you want!</p>
</th>
<th>


<tr>
  <script src="DataBase.js"></script>
 <script src="app.js"></script>
          </div>
        </form>
      </div>
    </div>

  </body>
</html>
